<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exam System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/edit_exam_form_page_style.css}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/1571ce0189.js" crossorigin="anonymous"></script>
</head>
<body>
<header>
    <div class="top-bar">
        <button type="button" class="btn btn-secondary menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-bars"></i> Menu
        </button>
        <h1>
            <span th:if="${loggedInUser}" th:text="${'Witaj, ' + loggedInUser.firstName + ' ' + loggedInUser.lastName + '!'}"></span>
        </h1>
        <div class="auth-buttons">
                <span th:if="${loggedInUser}">
                    <button type="button" class="btn btn-secondary logout-button" onclick="logout()">Wyloguj się</button>
                </span>
        </div>
    </div>
</header>

<div class="toolbar-menu">
    <nav class="side-menu">
        <button type="button" class="btn btn-secondary menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-times"></i> Zamknij
        </button>
        <span th:if="${role eq 'Administrator'}">
            <a href="/admin_panel">Panel administratora</a>
        </span>
        <span th:if="${role eq 'Administrator'}">
            <a href="/reports">Zgłoszenia</a>
        </span>
        <a href="/main_page">Strona główna</a>
        <span th:if="${role eq 'Egzaminator'}">
            <a href="/exams">Egzaminy</a>
        </span>
        <span th:if="${role eq 'Egzaminowany'}">
            <a href="/available_exams">Dostępne egzaminy</a>
        </span>
        <a href="/contact_us">Kontakt</a>
        <a href="/about_us">O nas</a>
    </nav>
</div>

<div class="exam-content">
<div class="container">
    <h2>Edycja danych egzaminu</h2>
    <form th:action="@{/edit/{examId}(examId=${exam.id})}" method="post">
        <input type="hidden" name="id" th:value="${exam.id}">
        <div class="form-group">
            <label for="name">Nazwa egzaminu:</label>
            <input type="text" id="name" name="name" class="form-control" th:value="${exam.name}">
        </div>
        <div class="form-group">
            <label for="description">Opis egzaminu:</label>
            <textarea id="description" name="description" class="form-control" th:text="${exam.description}"></textarea>
        </div>
        <div class="form-group">
            <label for="date">Data egzaminu:</label>
            <input type="date" id="date" name="date" class="form-control" th:value="${#dates.format(exam.date, 'yyyy-MM-dd')}">
        </div>
        <div class="form-group">
            <label for="duration">Czas trwania (w minutach):</label>
            <input type="number" id="duration" name="duration" class="form-control" th:value="${exam.duration}">
        </div>
        <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
    </form>
</div>


    <div class="container">
        <h2>Edycja pytań i odpowiedzi</h2>
        <form th:action="@{/edit/{examId}/questions(examId=${exam.id})}" method="post">
            <div th:each="question, questionStat : ${exam.questions}">
                <input type="hidden" th:name="'questions[' + ${questionStat.index} + '].id'" th:value="${question.id}">
                <div class="form-group">
                    <label th:for="'questionText-' + ${question.id}">Pytanie:</label>
                    <input type="text" th:id="'questionText-' + ${question.id}" th:name="'questions[' + ${questionStat.index} + '].question'" class="form-control" th:value="${question.question}" required>
                </div>
                <div class="form-group">
                    <label th:for="'questionType-' + ${question.id}">Typ pytania:</label>
                    <input type="text" th:id="'questionType-' + ${question.id}" th:name="'questions[' + ${questionStat.index} + '].questionType'" class="form-control" th:value="${question.questionType}" required>
                </div>
                <div class="form-group" th:each="answer, answerStat : ${question.answers}">
                    <input type="hidden" th:name="'questions[' + ${questionStat.index} + '].answers[' + ${answerStat.index} + '].id'" th:value="${answer.id}">
                    <label th:for="'answerText-' + ${answer.id}">Odpowiedź:</label>
                    <input type="text" th:id="'answerText-' + ${answer.id}" th:name="'questions[' + ${questionStat.index} + '].answers[' + ${answerStat.index} + '].answerText'" class="form-control" th:value="${answer.answerText}" required>
                    <label>
                        <input type="checkbox" th:name="'questions[' + ${questionStat.index} + '].answers[' + ${answerStat.index} + '].correct'" th:checked="${answer.correct}"> Poprawna odpowiedź
                    </label>
                </div>
                <hr class = "style-seven">
            </div>
            <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
        </form>
    </div>

    <div class="container">
        <h2>Dodawanie nowych pytań i odpowiedzi</h2>
        <form th:action="@{/edit/{examId}/questions/add(examId=${exam.id})}" method="post">
            <div class="form-group">
                <label for="newQuestionText">Nowe pytanie:</label>
                <input type="text" id="newQuestionText" name="newQuestionText" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="newQuestionType">Typ pytania:</label>
                <input type="text" id="newQuestionType" name="newQuestionType" class="form-control" required>
            </div>
            <div id="newAnswersContainer">
                <div class="form-group">
                    <label for="newAnswerText-0">Nowa odpowiedź:</label>
                    <input type="text" id="newAnswerText-0" name="newAnswers[0].answerText" class="form-control" required>
                    <label>
                        <input type="radio" name="correctAnswer" value="0"> Poprawna odpowiedź
                    </label>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" onclick="addNewAnswer()">Dodaj odpowiedź</button>
            <button type="submit" class="btn btn-primary">Dodaj pytanie</button>
        </form>
    </div>




</div>
<footer>
    <p>&copy; 2024 ExamSystem. Wszystkie prawa zastrzeżone.</p>
</footer>
<script>
    let answerIndex = 1;
    function addNewAnswer() {
        const container = document.getElementById('newAnswersContainer');
        const newAnswerHtml = `
            <div class="form-group">
                <label for="newAnswerText-${answerIndex}">Nowa odpowiedź:</label>
                <input type="text" id="newAnswerText-${answerIndex}" name="newAnswers[${answerIndex}].answerText" class="form-control" required>
                <label>
                    <input type="radio" name="correctAnswer" value="${answerIndex}"> Poprawna odpowiedź
                </label>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', newAnswerHtml);
        answerIndex++;
    }
</script>
<script>
    function toggleMenu() {
        var sideMenu = document.querySelector('.side-menu');
        sideMenu.classList.toggle('open');
    }

    function logout() {
        window.location.href = "/logout";
    }
</script>
</body>
</html>
<!--        <div class="form-group">-->
<!--            <label>Pytania:</label>-->
<!--            <div th:each="question, questionStat : ${questions}">-->
<!--                <h4 th:text="${question.question}"></h4>-->
<!--                <input type="hidden" th:name="${'questions[' + questionStat.index + '].id'}" th:value="${question.id}">-->
<!--                <div class="answer-options" th:each="option, optionStat : ${question.answers}">-->
<!--                    <input type="radio" th:id="${'question_' + questionStat.index + '_answer_' + optionStat.index}" th:name="${'questions[' + questionStat.index + '].correctAnswerId'}" th:value="${option.id}" th:checked="${option.correct}">-->
<!--                    <label class="form-check-label" th:for="${'question_' + questionStat.index + '_answer_' + optionStat.index}" th:text="${option.answerText}"></label>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->